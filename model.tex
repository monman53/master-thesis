\chapter{実験方法}
% 先行研究に置いて，蛍光観察などからゲルカプセルのパターンはDNAと水分子の2成分から構成されていると考察された．
%TODO 要出典
% この考察からパターン形成は2成分からなる相分離現象により引き起こされると考えた．
% 相分離とは1相からなる混合物が2つ以上の相に分離する現象のことで，
% 例えば油と水の分離や，
% 合金においてみられる現象である．
%TODO 要出典

\section{粘弾性相分離}
液体における通常の相分離では少数成分が液滴を形成し安定状態に落ち着くが，
少数成分を構成する分子が粘弾性力などの相互作用の影響で拡散が遅い場合，
少数成分が液滴を形成する前にネットワークを形成し多数成分が液滴を形成するという通常とは逆の状態が過渡期に観測される．
このような現象は粘弾性相分離と呼ばれ~\cite{tanaka2009formation}，
粘性や弾性といった構成分子の動力学的な影響がパターン形成に重要な役割を果たす(図~\ref{fig:veps})．
本研究で注目しているDNAゲルカプセルにおいても，
先の実験結果からY-DNAのsticky-endsによる粘弾性がそのパターン形成に寄与している可能性があり，
粘弾性相分離現象で説明ができるのではないかと考えた．

\begin{figure}
\centering
\includesvg{image/veps.svg}
\caption{
    粘弾性相分離現象の模式図．
    Tanakaらの論文~\cite{tanaka2009formation}より．
}

\label{fig:veps}
\end{figure}

\section{数理モデル}
今回，粘弾性相分離現象の数値解析を行うにあたりArakiらのモデル~\cite{araki2005simple}を用いた．
このモデルでは2次元空間での粘弾性相分離を仮定し，
少数成分を疎視化するラグランジュ型のモデルである．

はじめに粒子(疎視化点)は六方格子状に一様に配置され，
各粒子は隣接する6つの粒子と自然長$0$のバネで接続される．
この状態から，以下のランジュバン方程式を数値的に解いていく．


\begin{figure}
\centering
\includesvg{image/model_2d.svg}
\caption{
    Araki~\cite{araki2005simple}らのモデルの概要．
    (a) 初期状態．計算点の粒子が六方格子上に等間隔に配置され，
        隣接する6つの粒子と自然長$0$で長さ$l_0$のバネにより接続される．
        空間は周期境界条件が適用される．
    (b) 初期配置の拡大図．
    (c) シミュレーションの時間発展の様子．
        粒子の熱ゆらぎと共に，
        接続されていたバネが次第に切断されていくことで粘弾性相分離現象が再現される．
}
\label{fig:model_2d}
\end{figure}


\begin{equation}
\label{eq:main}
\zeta
\frac{d}{dt}
\vec{R}_i
=
-\frac{\partial}{\partial\vec{R}_i}
U_{tot}\{\vec{R}_i\}
+\vec{\xi}_i
.
\end{equation}

$\vec{R}_i$は粒子$i$の位置ベクトル，$\zeta$は粘性抵抗を意味する．
$\vec{\xi}_i$は以下の揺動散逸定理を満たす粒子iにおける熱ゆらぎの項である．

\begin{eqnarray}
\label{eq:langevin0}
\langle\vec{\xi}_i\rangle &=& 0, \\
\label{eq:langevin1}
\langle\vec{\xi}_i(t):\vec{\xi}_j(t')\rangle &=& 2T\zeta\delta_{ij}\delta(t-t')\bm{I}.
\end{eqnarray}

$U_{tot}$は粒子$i$の総ポテンシャルであり，
次のように2つのポテンシャルの和で表される．

\begin{eqnarray}
U_{tot}\{\vec{R}_i\}
&=
 U_{LJ}\{\vec{R}_i\}
+U_{sp}\{\vec{R}_i\}.
\end{eqnarray}

$U_{LJ}$，$U_{sp}$はそれぞれレナード・ジョーンズポテンシャルとバネによる調和ポテンシャルであり，
定義は次のとおりである．

\begin{eqnarray}
U_{LJ}\{\vec{R}_i\}
&=&
4\epsilon\sum_{j\neq i}
\left\{
\left(
\frac{\sigma}{\bigl|\vec{R}_j-\vec{R}_i\bigr|}
\right)^{12}
-
\left(
\frac{\sigma}{\bigl|\vec{R}_j-\vec{R}_i\bigr|}
\right)^{6}
\right\},
\\
U_{sp}\{\vec{R}_i\}
&=&
\frac{1}{2}
\kappa
\sideset{}{'}\sum_{j\neq i}
\bigl|\vec{R}_j-\vec{R}_i\bigr|^{2}.
\end{eqnarray}

$\epsilon$，$\sigma$，$\kappa$はそれぞれポテンシャルを特徴づける定数であり，
調和ポテンシャルにおける記号$\sideset{}{'}\sum$はバネにより接続された粒子間での和を意味する．

初期状態で接続されていたバネは，時間が経つにつれランダムに切断されていく．
その切断確率$p$は温度$T$とバネの長$l$に依存する形で定義され，
各計算ステップで全バネに対して切断するかしないかの処理がなされる．

\begin{eqnarray}
p(l)
&=&
t_0^{-1}
\exp\left(-\frac{\Delta E(l)}{T}\right)
,\\
\Delta E(l)
&=&
E_0-\frac{\kappa l^2}{2}
\end{eqnarray}

具体的には，$0$から$1$の一様乱数$r$を発生させ，$r<p(l)$ならバネを切断する．
$t_0$は数値計算の1ステップの時間で，$E_0$はバネの切れやすさを意味する定数である．
一度切断されたバネは二度と繋がることはなく，粒子間で新たにバネが接続されることもない．


\section{温度項の拡張}
実際のゲルカプセルの作製では温度は一定ではなく，
線形に温度を下げていくアニーリングが施される．
この状況を再現するために，温度項を次のように変更した．

\begin{eqnarray}
T = T_{max}(1-\frac{t}{t_{max}})
\end{eqnarray}

$T_{max}$は初期状態の温度で，$t_{max}$はシミュレーションの終了時間である．
つまり$t=0$で$T=T_{max}$，
$t=t_{max}$で$T=0$になるような線形アニーリングを再現している．


\section{球面上への拡張}
カプセル状での粘弾性相分離現象をシミュレーションするために，
本研究では上記のモデルの球面上への拡張を行った．

まず，ある大きさのGeodesic Grid~\cite{Geodesic}を用意し，
その頂点に粒子を配置し辺の部分をバネとすることで初期状態とする．
この状態からランジュバン方程式を解き，移動した$R_i$を球面上に射影し直すことで常に粒子が球面上にとどまるように計算を繰り返していく．
他の処理に関しては元のモデルと同じである．

%TODO webpage の ref



\section{実装}
本モデルがラグランジュ型のモデルであり，
バネの切断などの特殊な処理が必要であることから，
汎用のシミュレーションソフトウェアでの実験は困難であると考えた．
しかし，モデルは単純であり実装は困難ではないと判断したためシミュレーションプログラムは自ら実装した．

まず，オイラー法による計算を考え，運動方程式(\ref{eq:main})を次のように離散化した．
\begin{eqnarray}
    \vec{R}_i(t+\Delta t) &=& 
    \vec{R}(t)_i
    -\frac{1}{\zeta}\frac{\partial}{\partial\vec{R}_i(t)}U(\vec{R}_i(t))\Delta t
    +\chi\sqrt{\frac{2k_B T}{\zeta}\Delta t}
    .
\end{eqnarray}

次に，各物理量をそれぞれ
$x=l_0 \tilde{x}$，
$t=t_0 \tilde{t}$，
$\zeta=\kappa t_0 \tilde{\zeta}$，
$E=\frac{1}{2}\kappa\l_0^2\tilde{E}$
でスケールし無次元化した．
以下，特に記述がなければ物理量は無次元化されたものとする．


プログラムはC++言語で記述し，ベクトル計算にEigen~\cite{eigenweb}を使用した．
データの可視化にはParaView~\cite{paraview}とPOV-Ray~\cite{povray}をそれぞれ用いた．
計算はラップトップPC上(Intel Core i5-7300U CPU)で並列実行した．


\section{解析}
シミュレーションで得られた構造を定量的に解析する必要がある．
本研究では構造の特徴として孔の大きさの分布を考えた．

得られた構造と，その構造に対して十分小さなグリッドを持つGeodesic Gridを重ね合わせ，
三角形が重なり合わないGeodesic Grid上の連続領域を検出することで孔の検出を行った．

\subsection{計算結果のポリゴン化}
元のモデルでは計算結果は頂点と辺(バネ)のみであるが，
相分離により形成された孔の解析を行うためにポリゴン化を行った．
ポリゴンを構成する三角形は，ある計算点と隣接する計算点で作られる三角形を全て用いた．
また，計算結果をわかりやすくするために配色を変更した．


\begin{figure}
\centering
\includesvg{image/polygon.svg}
\caption{
    計算結果のポリゴン化と配色の変更．
    (a) 変更前の計算結果のCG．
    (b) 同じ計算結果に対する適用後のCG．
}
\label{fig:model_2d}
\end{figure}


\subsection{点と三角形の衝突判定}
孔の検出で行いたい処理は球面上の三角形の衝突判定を繰り返し行うことで実現できる．
そのためにまず，2次元平面のある点が同じ平面上のある三角形の内側に存在するか外側に存在するかを判定するアルゴリズムについて説明する．

平面上の2つのベクトルの外積の値は，時計回りに演算された場合に正に，半時計回りに演算された場合に負になる．
この事実を利用し，

\begin{figure}
\centering
\includesvg{image/point_triangle.svg}
\caption{
    点の三角形内外判定アルゴリズム．
    点$p$から点$q_i$，$q_{(i+1 mod 3)}$へのベクトルの外積を3つの$i$について調べ，
    それらの符号を見ることにより判定できる．
    (a) 点が三角形の外側にある場合は外積の符号が一致しない．
        左2つは外積の値が負になるが，一番右のケースで正になる．
    (b) 点が内側にある場合は外積の符号が全て一致する．
}
\label{fig:point_triangle}
\end{figure}

\subsection{球面上の三角形の衝突判定}
